

# API CREATOR SERVER Project

It's a node.js server that have modulized design. The server can set many groups of API. The project `api-creator-server` has an API group directory `/api` that contains all APIs about `Swagger API file GUI`.

You can promptly create an API file of swagger in '.json' format. The .json file which be edited in GUI will show at directory `/public/apiDoc`. swagger 2.0 version json file will be generated by server.

You can run `node server.mjs` command to start server.

The `api-creator-server` project only contains server-side. If you want to open the Web GUI, you need to run another project which named `api-creator-react`.

- [Setting API group](#Setting-API-group)
- [API File Format](#API-File-Format)
- [Swagger API file GUI](#Swagger-API-file-GUI)

# Setting API group

You can change directory easily in `/config.js` file.

```javascript
module.exports = {
    apiFolder: [{
        apiPrefix: '/api',
        path: './api',
        port: 8021,
    }, {
        apiPrefix: '/api',
        path: './apiQorePlus',
        port: 8022,
    }],
};
```

As you see, "port" can change the server receive port. "path" determines the directory of API group. Each API has its ".js" file to define the API format.

## API File Format

Taking `/[post]api_addApi.js` file as an example.

```javascript
const SwaggerManage = require("../swaggerManage/swaggerManage");
const checkRequired = require('../utils/checkRequired');
const PrehandleBuilder = require("../utils/PrehandleBuilder");

const apiData = {
    apiType: 'post',
    reactType: 'rest',
    apiRoute: '/api/api/addApi',
    prehandle: new PrehandleBuilder().checkRequired({ fileName: true, apiRoute: true, apiType: true, tags: true, summary: true,}),
    handle: async function (req, res) {
        const fileName = req.body.fileName;
        // ...skip
        res.react(swagMgObj);
    }
}
module.exports = apiData;
```

The function `res.react` can send an API response by a js object. But the object `swagMgObj` which will be handled by the response function. You can change the response function mode by `reactType`. The parameter `reactType` exists serveral mode as below.

- `rest`: handle function `restReact`
- `json`: handle function `jsonReact`
- `raw`: handle function `rawReact`

You can see the handle functions in `/ApiLoader.js` module.

```javascript
// skip...
function jsonReact(req, res, obj) {
    return res.json(obj);
}

function rawReact(req, res, str) {
    return res.send(str);
    // return res.json(json);
}

function restReact(req, res, data = null) {
    return res.json({
        code: "0", // 0代表成功
        data: data,
        msg: "ok",
    });
}
// skip...
```

# Swagger API file GUI

The following is a part of swagger file `/public/apiDoc/api-creator.json`. It's the swagger 2.0 API config file.

```json
{
	"swagger": "2.0",
	"host": "localhost:8021",
	"info": {
		"description": "",
		"version": "1.0.0",
		"title": "api-creator"
	},
	"tags": [
		{
			"name": "doc",
			"description": "檔案相關",
			"groupName": "檔案"
		}// ...skip
	],
	"paths": {
		"/api/listApiDoc": {
			"post": {
				"produces": [
					"application/json"
				],
				"tags": [
					"doc"
				],
				"summary": "1-2.列出API文件",
				"parameters": [
					{
						"description": "Payload",
						"name": "Body",
						"in": "body",
						"required": true,
						"schema": {
							"type": "object",
							"properties": {
								"fileName": {
									"type": "string",
									"description": "fileName_bbbbb",
									"default": "api-creator"
								}
							},
							"required": [
								"fileName"
							]
						}
					}
				],
				"responses": {
					"200": {
						"description": "",
						"schema": {
							"type": "object",
							"properties": {
								"code": {
									"type": "string",
									"description": ""
								},
								"data": {
									"type": "object",
									"properties": {
										"list": {
											"type": "array",
											"items": {
												"type": "object",
												"properties": {
													"fileName": {
														"type": "string",
														"description": "",
														"default": "api-creator.json"
													},
													"path": {
														"type": "string",
														"description": "",
														"default": "../api-creator.json"
													}
												},
												"required": [
													
												]
											}
										}
									},
									"required": [
										
									]
								},
								"msg": {
									"type": "string",
									"description": ""
								}
							},
							"required": [
								
							]
						}
					}
				}
			}
		},
    }
}
```


# 資料格式輸入

## 匯入物件陣列的方法
rootType填入`TYPE_LWPWMA4J`即可以該物件為基底生成巢狀資料


```gql
input TYPE_LWPWMA4J {
   aaaa: [TYPE_LWPWMIJX]
}
input TYPE_LWPWMIJX {
   bbbb: String = "bb"
}
````
